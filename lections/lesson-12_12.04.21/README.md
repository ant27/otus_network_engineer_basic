## Занятие 12. Технология VLAN, маршрутизация в VLAN.

Дата занятия: 12.04.21

### Определение технологии VLAN.

VLAN - это дополнение протокола канального уровня (Ethernet) для логического разделения физической сети на изолированные виртуальные. По сути - это внедрение в кадр ethernet поля с номером VLAN, которое может добавляться, сниматься и анализироваться сетевым оборудованием, поддерживающим технологию VLAN - IEEE 802.1q.

### Можно ли обойтись без VLAN?

В самом деле - можно ли разделить физическую  ethernet сеть на изолированные логические подсети без применения технологии VLAN? На чистом канальном уровне - нет, но, так, как на данный момент ethernet практически всегда идет в связке с протоколом IP, то с его использованием можно. Необходимо настроить на узлах сети, которые мы хотим изолировать друг от друга разные IP подсети. Таким образом они будут на канальном уровне находиться в одной сети, но логически в разных, так как сетевые интерфейсы отбрасывают IP пакеты, которые не предназначены им.

Однако, хоть такие узлы и изолированы друг от друга механизмом работы протокола IP, но они не изолированы от широковещательного траффика друг друга. Также страдает безопасность, так как злоумышленник, имеющий доступ к сети, может подключиться в любую подсеть, настроив нужный IP на своем хосте.  

### Преимущества VLAN.

- Экономия сетевых ресурсов
- Изоляция (сегментация) различных групп устройств на одном сетевом оборудовании
- Ограничение широковещательных, многоадресных и одноадресных передач в каждом отдельном VLAN.

### Типы сетей VLAN.

- ***default*** - VLAN по умолчанию. Всегда имеет номер 1. Его нельзя удалить или переименовать.
- ***native*** - VLAN для нетегиированного траффика от устаревших устройств. По умолчанию совпадает с default, но его номер можно изменить.
- ***1002 - 1005*** - VLAN, зарезервированные для устаревших протоколов. 
- ***voice*** - VLAN, выделенная специально для голосового траффика. Особенность этой VLAN в том, что ее можно настраивать на интерфейсе коммутатора одновременно с другим VLAN (в общем случае один интерфейс можно включить только в один VLAN), а также в том, что траффику в этом VLAN дается высокий приоритет обслуживания. 

### Магистральные (транковые) порты.

Для обеспечения сетевой связности коммутаторов, на которых настроны несколько VLAN, можно соединить между этими коммутаторами по каждому одному порту, настроеному в каждом VLAN. Тогда связность каждого VLAN будет обеспечена, но это приведет к неоправданному расходу сетевых портов и кабелей. Поэтому была придумана технология магистральных портов, которые сами по себе не принадлежат ни к одному VLAN, но передают траффик нескольких (или всех) VLAN между коммутаторами.

### Тегирование кадров Ethernet для идентификации VLAN.

Поле идентификатора VLAN внедряется после поля Src MAC и состоит:

- TPID (16 бит) - идентификатор протокола тегов (для VLAN 0x8100) 
- Pri (3 бит) - приоритет CoS (7 уровней)
- CFI (1 бит) - идентификатор кадров token ring
- VID (12 бит) - идентификатор VLAN (до 4096 VLAN). У провайдеров используется технология двойного тегирования для получения 4096^2 VLAN.


