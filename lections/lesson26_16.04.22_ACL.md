# Списки контроля доступа ACL.

Список контроля доступа (ACL) — это последовательный список разрешающих или запрещающих операторов, называемых записями списка контроля доступа (ACE).

## Принцип обработки правил ACE

При прохождении сетевого трафика через интерфейс, где действует список контроля доступа (ACL), маршрутизатор *последовательно* сопоставляет информацию из пакета с каждой записью в списке контроля доступа на предмет соответствия, начиная с самой первой. Первая запись, условия которой соотвествуют проверяемому пакету, применяется к нему, остальные записи, ниже в списке, уже не используются. Если запись не подходит по условию, то пакет проверяется дальше по списку.

*Примечание: Последней записью ACL-списка всегда является косвенный отказ, блокирующий весь трафик. Он скрыт и не отображается в конфигурации. Поэтому ACL должен иметь по крайней мере одну инструкцию разрешения, иначе весь трафик будет отклонен из-за неявного оператора deny ACE.

## Важная функция ACL

Кроме обеспечения фильтрации траффика одной из важных функций ACL является маркировка траффика. Например, можно определить диапазон IP адресов, описав его в ACL, а потом применить этот список к протоколу NAT, чтобы определить, к каким IP адресам должен применяться NAT.

## Обработка входящего и исходящего трафика.

- Входящий ACL фильтрует пакеты, приходящие на определенный интерфейс, до выполнения маршрутизации. Таким образом сохраняются ресурсы на поиск маршрута, если пакет сбрасывается правилом.
- Исходящий ACL фильтрует пакеты после их маршрутизации — вне зависимости от входящего интерфейса.

## Стандартые и расширенные списки ACL

- Стандартные списки ACL- ACL фильтруют только на уровне 3, используя только адрес источника IPv4. 
- Расширенные списки ACL- фильтр ACL на уровне 3 с
использованием адреса IPv4 источника и/или назначения. Они также могут фильтровать на уровне 4, используя порты TCP, UDP и дополнительную информацию о типе протокола для более точного управления.

## Использование шаблонных (обратных) масок в ACL-списке.

IPv4 ACE использует 32-разрядную шаблонную маску, чтобы определить, какие биты адреса необходимо проверить на соответствие.
Cisco IOS предоставляет два ключевых слова для определения наиболее распространенных видов применения маскировки подстановочных знаков.

Два ключевых слова:
- host - применяется для маски 0.0.0.0. Эта маска подразумевает соответствие всех битов IPv4-адреса. Таким образом, фильтруется единственный адрес хоста.
- any - замещает маску 255.255.255.255 Эта маска указывает игнорировать весь IPv4-адрес или принять любой адрес.

## Именованные и нумерованные списки

ACL, пронумерованные 1-99 или 1300-1999, являются стандартными ACL, в то время как ACL, пронумерованные 100-199 или 2000-2699, являются расширенными ACL.
Именованные списки ACL задаются с названием.

## Размещение списков ACL

Каждый список контроля доступа (ACL) должен быть размещен там, где он может демонстрировать максимальную эффективность. Расширенные списки контроля доступа следует располагать как можно ближе к источнику фильтруемого трафика.  Стандартные списки контроля доступа следует размещать как можно ближе к месту назначения.


## Синтаксис создания стандартных нумерованных списков ACL
```
R1(config)# access-list access-list-number {deny|permit|remark text} source [source-wildcard] [log]
```

## Синтаксис создания именованных стандартных списков ACL
```
R1(config)# ip access-list standard FTP-FILTER
R1(config-ext-nacl)# permit tcp 192.168.10.0 0.0.0.255 any eq ftp
R1 (config-ext-nacl) # permit tcp 192.168.10.0 0.0.255 any eq ftp-data
```

## Применение стандартного списка ACL

Для применения ACL на интерфейсе необходимо войти в режим конфигурации интерфейса.

```
R1(config-if)# ip access-group {access-list-number | access-list-name} {in|out}
R1(config-if)# no ip access-group
```
*Примечание!!! Если удалить примененный к каком-либо интерфейсу ACL без отмены применения его на интерфейсе, траффик через этот интерфейс блокируется, так как начинает действовать запрещающее правило по умолчанию.


## Пример создания и применения стандартного нумерованного ACL

```
R1(config)# access-list 10 remark ACE permits ONLY host 192.168.10.10 to WAN
R1(config)# access-list 10 permit host 192.168.10.10
R1(config)# interface S0/1
R1(config-if)# ip access-group 10 out
```

## Пример создания и применения стандартного именованного ACL

```
R1(config)#ip access-list standard PERMIT-ACCESS
R1(config-std-nacl)#remark ACE permits ONLY host 192.168.10.10 to WAN
R1(config-std-nacl)#permit host 192.168.10.10
R1(config)#interface S0/1
R1(config-if)# ip access-group PERMIT-ACCESS out
```

## Просмотр созданных ACL
```
R1#show access-lists
```

## Очистка счетчиков сработки ACL
```
R1#clear access-list counters NO-ACCESS
```


## Просмотр примененных на интерфейсе ACL
```
R1#show ip int S0/1 | include access list
```

## Редактирование правил методом порядковых номеров
```
R1(config)#ip access-list standard PERMIT-ACCESS
R1(config-std-nacl)#no 10
R1(config-std-nacl)#10 permit host 192.168.10.10
```
В данном примере удаляется первое правило и заменяется новым. 

```
R1(config)#ip access-list standard PERMIT-ACCESS
R1(config-std-nacl)#15 permit host 192.168.10.10
```
В данном примере правило добавится между 10 и 20 правилами (1-м и 2-м). 

