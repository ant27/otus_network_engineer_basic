### Занятие 1. Конспект.

Дата занятия: 26.02.21

#### Базовая настройка сетевых устройств CISCO.

##### Последовательность загрузки коммутатора.

- Загрузка коммутатором из своего неизменяемого ПЗУ (ROM) программы самотестирования POST для тестирования процессора, DRAM и flash-памяти. В случае ошибок при самотестировании загрузка останавливается.
- Загрузка коммутаторм из своего неизменяемого ПЗУ (ROM) начального загрузчика (BOOT), который выполняет низкоуровневую инициалиацию ЦПУ (регистров) и файловой системы flash-памяти.
- Поиск начальным загрузчиком на flash-памяти образа операционной системы IOS, загрузка его в оперативную память и передача ему управления коммутатором. 
По умолчанию, когда не установлено значение переменной BOOT, начальный загрузчик использует для загрузки первый файл на flash-памяти с расширением bin.
 
Командой boot system загрузчику указывается конкретный путь к образу:

`S1#configure terminal`

`S1(config)#boot system flash:c3620-jk9o3s-mz.122-7a.bin`

`S1(config)#boot system flash:c3620-jos56i-l.120-11.bin`

`S1(config)#boot system slot0:c3620-ik9s-mz.122-13.bin`

`S1(config)#boot system rom`

`S1(config)#end`

`S1#copy running-config startup-config`


Следующей командой можно посмотреть все ранее установленные пути к образам:

`S1#show boot`

Следующей командой можно удалить все ранее установленные пути к образам:

`S1#configure terminal`

`S1(config)#no boot system`

`S1(config)#end`

`S1#copy running-config startup-config`

- IOS, загруженная в оперативную память, находит в NVRAM-памяти (особом виде флэш памяти) загрузочную конфигурацию startup-config, которая называется обычно config.text и последовательно выполняет команды из нее. Таким образом инициализируются интерфейсы коммутатора.

Дополнильно разобраться: где все таки физически находится  startup-config и как называется.

##### Индикация коммутатора.
- SYST - индикатор питания и системных ошибок
- RPS - индикатор резервного источника питания
- STAT - индикатор состояния порта
- DUPLEX - индикатор режима порта
- SPEED - индиктаор скорости порта
- PoE - индикатор подачи питания PoE на порт

Для перемещения по порту используется кнопка MODE.

##### Восстановление после сбоя.

- Подключение ПК через консольный кабель к консольному порту.
- Выключение коммутатора
- Включение коммутатора и удерживание кнопки "MODE"
- Изменение индикации индикатора SYST с мигания зеленым цветом, потом желтым, потом сплошное свечение зеленым.
- Отпускание кнопки "MODE"
- В эмуляторе терминала на ПК появится запрос switch или rommon начального загрузчика.

##### Настройка доступа для удаленного управления коммутатором.

- Необходимо настроить виртуальный интерфейс коммутатора (SVI) в определенном VLAN. 
- Затем назначить ему IP адрес.
- Затем назначить ему шлюз по умолчанию.

`S1#configure terminal`

`S1(config)#interface vlan 99`

`S1(config)#ip address 172.17.99.11 255.255.255.0`

`S1(config)#ip default-gateway 172.17.99.1`

`S1#ipv6 address 2001:db8:acad:99::1/64`

`S1#no shutdown`

`S1#end`

`S1#copy running-config startup-config`

- Проверить настроенную конфигурацию можно командой:

`S1#show ip interface brief`

`S1#show ipv6 interface brief`

##### Настройка физических параметров портов коммутатора

По умолчанию на всех современных сетевых устройствах работает автосогласование режима и скорости портов коммутатора.

Задать эти параметры вручную можно командами:

`S1#configure terminal`

`S1(config)#interface FastEthernet 0/1`

`S1(config)#duplex full`

`S1(config)#speed 100`

`S1(config)#end`

`S1#copy running-config startup-config`

- Примечание: настройки режима и скорости должны быть установлены на обоих сторонах линии, так как при ручной настройке автосогласование отключается.

Auto-MDIX - автоматическое определение типа кабельного соединения (прямого или перекрестного).

Должно быть включено по умолчанию, вручную включается командой mdix auto. 

##### Команды проверки коммутатора.

`S1#show interfaces [interface-id]`

`S1#show startup-config`

`S1#show running-config`

`S1#show flash`

`S1#show version`

`S1#show history`

`S1#show ip interface [interface-id]`

`S1#show mac-address-table`

##### Диагностика проблем сетевого доступа.

Вывод команды show interfaces:
- Состояние "down" в первой строке вывода указывает на проблемы на аппаратном уровне (например отсутствие несущей, ошибка автососгласования).
- Состояние "down" во второй строке вывода указывает на проблемы на логическом уровне (например, не работает протокол LACP)

Проблемы на уровне сетевого доступа:
- Ошибки ввода (карликовые и гигантские кадры, отсутствие буфера, CRC, ошибки в кадрах, переполнение буфера, проигнорированнные пакеты )
- Карликовые кадры (кадры меньше 64 байт для ethernet)
- Гигантские кадры (кадры больше 1518 байт для ethernet)
- CRC (кадры с неверной контрольной суммой)
- Ошибки вывода
- Коллизии

Дополнильно разобраться: колизии при настройке на одной линии full- и half-duplex.

##### Безопасный удаленный доступ.

Telnet (TCP 23 port) - протокол удаленного терминального интерфейса, использующий небезопасную незашифрованную передачу данных.

Дополнильно разобраться: получить Wireshark'ом пакеты с логином и паролем telnet.

Telnet (TCP 22 port) - защищенный (шифрованный) протокол терминального интерфейса.
Для использования ssh в сетевых устройствах CISCO требуется версия IOS, поддерживающая шифрование - имеющая в названии комбинацию "K9".
Версии IOS, не имеющие криптографических функций имею в названии комбинацию "K8NPE". На них не работает SSH и IPSEC.

Порядок настройки удаленного доступа по SSH:
- Проверка поддержки SSH. Необходимо ввести команду **show ip ssh**
Примечание: по умолчанию настроен SSH первой версии (1.99). Необходимо последующими шагами настроить SSH второй версии. 
- Настройка IP-домена с помощью команды **ip domain-name**
Примечание: настройка IP домена нужна для настройки ssl сертификата. 
- Создание пар ключей RSA **crypto key generate rsa**.
- Создание пользователя на сетевом устройстве с помощью команды **username *** password *** secret** 
- Включение протокола SSH на линиях vty с помощью команды **transport input ssh**.
- Включение использования локальной аутентификации (аутентификации с помощью списка пользователей, настроеных на самом устройстве) с помощью команды **login local**
- Включение SSH версии 2 с помощью команды **lp ssh version 2**
- Проверка работы SSH на устройстве с помощью команд **show ip ssh** и **show ssh**
- Для удаления пары ключей RSA используйте команду **crypto key zeroize rsa** 

##### Базовая настройка маршрутизатора.

`R1#configure terminal`

- Настройка hostname маршрутизатора

`R1#hostname R1`

- Настройка пароля для привилилегированного режима:

`R1#enable secret class`

- Настройка подключения по физическому консольному терминалу:

`R1#line console 0`

`R1#password cisco`

- Команда включения требования пароля для подключения по физическому консольному терминалу:

`R1#login`

`R1#exit`

- Настройка подключения по виртуальному терминалу vty (удаленных подключний):

`R1#line vty 0 4`

- Примечание: всего одновременных удаленных подключений может быть 16. По умолчанию они отключены. Команда выше включает 5 из них, то есть на устройстве возможн до 5 одновременных подключений.

`R1#password cisco`

`R1#login`

`R1#exit`

- Зашифровка пароля для неотображения его в явном виде в конфигурации:

`R1#service password-encryption`

- Настройка приветсвенного баннера:

`R1#banner motd $ Authorized Access Only! $`

`R1#copy running-config startup-config`

##### Настройка интерфейсов маршрутизатора.

`R1#interface gigabitethernet 0/0/0`

`R1#ip address 192.168.10.1 255.255.255.0`

`R1#ipv6 address 2001:db8:acad:99::1/64`

`R1#description Link to LAN 1`

`R1#no shutdown`

`R1#exit`

##### Настройка интерфейса loopback маршрутизатора.

`R1#interface loopback number`

`R1#ip address ip-address subnet-mask`

- Дополнильно разобраться: назначения loopback интерфеса

##### Вывод таблицы маршрутизации маршрутизатора.

`R1#show ip route`

##### Полезные команды сетевых устройств cisco.

- Вывод раздел, начиная с данных, соответсвующих условиям фильтрации

`R1#show | section`

- Вывод всех строк данных, соответсвующих условиям фильтрации

`R1#show | include`

- Вывод всех строк данных, не соответсвующих условиям фильтрации

`R1#show | exclude`

- Вывод всех строк, начиная с данных, соответсвующих условиям фильтрации

`R1#show | begin`

- Настройка размера бухера истории команд

`R1#terminal history size`

- Настройка длины строк терминала

`R1#terminal length`
