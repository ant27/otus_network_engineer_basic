## Занятие 6. Разрешение IP адресов. Протоколы ARP и ND.

Дата занятия: 22.03.21

###  Назначение сетевого уровня стека IP.

Сетевой уровень предоставляет услугу по обмену данными между конечными устройствами, находящимися как в одной, так и в разных сетях. Тогда как канальный уровень поддерживает связь только в одной сети.

На данный момент протокол IP (IPv4 и IPv6) практически вытеснил все остальные протоколы, среди которых IPX и Aplle Talk. Эти протоколы не следует путать с тоже практически не используемыми и вытеснеными ethernet'ом протоколами канального уровня - X25, Frame Relay, Token Ring, FDDI, ATM.

Сетевой уровень выполняет основные операции:

- Уникальная адресация оконечных устройств (в протоколе сетевого уровня адреса всегда уникальны, за исключением NAT, о котором будет рассказано позже).
- Инкапсуляция - данные верхних уровней вкладываются в сетевой пакет со всеми их заголовками.
- Деинкапсуляция - процесс, обратный инкапсуляции
- Маршрутизация - передача данных из сети в сеть в соотвествии с правилами сетевых устройств.

Инкапсуляция:

- Использование протокола IP версий 4 и 6 никак не влияет на данные верхних уровней. 
- IP-пакет проверяется всеми устройствами уровня 3 по мере прохождения сети.
- IP-адресация не изменяется от источника к адресату (кроме случая NAT)



































- отвечает за передачу данных между сетевыми интерфейсными картами сети Ethernet
- позволяет протоколам верхнего уровня получать доступ к среде физического уровня
- выполняет обнаружение ошибок и удаляет поврежденные кадры.

Подуровни канального уровня IEEE 802

1. Logical Link Control (LLC)
2. Media Access Control (MAC)

LLC обеспечивает управление логическим каналом, то есть предоставляет сервис по передаче данных с установлением логического соединения или нет, с подтверждением передачи данных или нет.
MAC уровень предоставляет сервис по доступу к среде передачи.

Изначально одной из функций маршрутизатора наряду с передачей данных между разными сетями была была передача данных из одной среды передачи в другую. Для этого маршрутизатор обычно имеет в своем составе специализированные интерфейсные модули.

Физическая топология - физические сеоединения между сетевыми устройствами.
Логическая топология - виртуальные (логические) соединения между устройствами.

###  Типы топологий сетей WAN

1. Точка-точка
2. Звезда
3. Кольцо
4. Ячеистая		

Технология CSMA/C**D**

Технология использования общей среды передачи с обнаружением коллизий - использовалась в ранних версиях Ethernet на общей коаксиальной шине и хабах.

Технология CSMA/C**А**

Технология использования общей среды передачи с **предотвращением** коллизий - используется в сетях Wi-Fi.


###  Подуровень MAC

Отвечает за:
- формирование внутренней структуры кадра Ethernet
- адресацию в одноранговой сети Ethernet
- обнаружение ошибок Ethernet


###  Структура ethernet кадра

- Preamble (Преамбула) - 8 байт – последовательность, сигнализирующая другим абонентам, что абонент готовится начать передачу. Размер преамбулы был рассчитан таким образом, чтобы на сегменте сети предельной длины все абоненты гарантированно услышали ее.
-Destination address – 6  байт 
- Source address – 6 байт
- Type – 2 байта – спецификатор типа (или собственно код типа данных или код дополнительного заголовка)
- Data – 46 -1500 – поле данных (есть расширенные кадры по 4 и 9 кб, т.к.н. jumbo frame)
- FCS – frame check sequence – поле контрольной суммы.

###  MAC адрес

Состоит из 48 бит (6 байт)
первые три байта – это OUI  (organization unique id)– вендор или линейка оборудования вендора
вторые 3 байта – Vendor assigned – номер конкретного устройства (16 млн. Устройств одного вендора или одной линейки)

###  Типы MAC адресов

-Unicast – от одного абонента другому одному абоненту
-Broadcast – от одного абонента всем абонентам в широковещательном домене.
-Multicast – от абонента группе абонентов. 
-Anycast – от абонента к ближайшему или лучшему по какому то параметру в группе абоненту

Для определения MAC адреса назначения исходя из IP адреса используется протокол ARP, в IPv6 - ND (Neighbor discovery)

Для отсылки broadcast ip пакета протокол ARP разрешает его MAC адрес назначения в FF:FF:FF:FF:FF:FF кадра протокола Ethernet.

Примечание: broadcast кадр никогда он не пересылается маршрутизатором.

Для отсылки multicast IPv4 пакета протокол ARP разрешает его MACадрес назначения в 01:00:5E:XX:XX:XX, для multicast IPv6 пакета - 33:33:XX:XX:XX:XX

Существуют также дополнительные зарезервированные MAC адреса многоадресной рассылки, например пакеты протокола STP.

Примечание: multicast кадр рассылается на все порты коммутатора, за исключеним того, с которого он пришел, если коммутатор не настроен для многоадресного отслеживания. Также он не пересылается маршрутизатором, если он не настроен на маршрутизацию multicast пакетов. 

###  Коммутация кадров с помощью таблицы коммутации

В начальный момент времени у коммутатора пустая таблица MAC адресов (соответствия порта MAC адресу узла, который к нему подключен). Первый кадр, полученный с порта коммутатор рассылает на все остальные порты, так как пока не знает, на какой порт отправлять кадр, но делает запись в таблицу MAC адресов (MAC address learning). Дальше, если он увидит на любом порту кадр с адресом получателя, который у него уже есть в таблице MAC адресов, он уже не будет рассылать этот кадр по всем портам, а пробросит только на соответсвующий порт.

Способы коммутации:
1. с промежуточным хранением - кадр полностью принимается, вычисляется его контрольная сумма (CRC), если она неверная, кадр отбрасывается. Также анализируется поле QoS для приоритеризации траффика.
2. со сквозной пересылкой - кадр считывает только адрес назначения, определяет порт и пересылает его еще до его полного получения.

Буферизация памяти на коммутаторах:
1. Буферизация на основе портов - под каждый порт в памяти выделен свой буфер памяти. Следующие кадры в порт пересылаются только в случае успешной отправки кадров в очереди перед ним.
2. Буферизация на основе совместной памяти - все кадры содержатся в общем буфере, им присвоена метка, свзывающая их с портами назначения.

